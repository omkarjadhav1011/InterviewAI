{% extends 'base.html' %}
{% block title %}Interview{% endblock %}
{% block content %}
<style>
  .interview-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
    margin: 2rem auto;
    padding: 2rem;
    max-width: 1000px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
  }

  .interview-header {
    text-align: center;
  }

  .interview-header h2 {
    font-size: 2rem;
    color: #00bcd4;
    font-weight: 600;
    letter-spacing: 1px;
  }

  .interview-grid {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 2rem;
    width: 100%;
    align-items: center;
  }

  .camera {
    background: #111;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0, 188, 212, 0.4);
  }

  video {
    width: 100%;
    border-radius: 12px;
  }

  .center {
    text-align: center;
    background: #1b1b1b;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: inset 0 0 15px rgba(0, 188, 212, 0.3);
  }

  #question-text {
    font-size: 1.25rem;
    color: #fff;
    margin-bottom: 1rem;
  }

  #transcript, #feedback {
    color: #ddd;
    font-size: 0.95rem;
    background: rgba(255, 255, 255, 0.08);
    padding: 0.8rem;
    border-radius: 8px;
    margin: 0.5rem 0;
    min-height: 40px;
  }

  #progressDisplay {
    color: #00e676;
    margin-top: 0.5rem;
    font-size: 1rem;
  }

  .controls {
    margin-top: 1.2rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  button {
    background: #00bcd4;
    border: none;
    color: #fff;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover {
    background: #0097a7;
    transform: translateY(-2px);
  }

  button:disabled {
    background: #444;
    cursor: not-allowed;
  }

  @media (max-width: 768px) {
    .interview-grid {
      grid-template-columns: 1fr;
    }
    .camera, .center {
      width: 100%;
    }
  }
</style>

<div class="interview-container">
  <div class="interview-header">
    <h2>AI Interview Session</h2>
    <p style="color:#bbb;">Your responses will be analyzed in real-time. Speak clearly and confidently!</p>
  </div>

  <!-- Question Preview Section -->
  <div class="question-preview" style="width:100%; max-width:800px; margin:0 auto 1rem; background:rgba(0,0,0,0.2); padding:1.5rem; border-radius:12px;">
    <h3 style="color:#00bcd4; margin-bottom:1rem">Interview Overview</h3>
    <!-- Skills and questions populated dynamically -->
    <div id="question-list" style="color:#ddd;">
      <div class="loading" style="text-align:center; color:#666;">
        Loading interview content...
      </div>
    </div>
  </div>

  <div class="interview-grid">
    <div class="camera">
      <video id="camera" autoplay playsinline></video>
    </div>

    <div class="center">
      <h3 id="question-text">Waiting for question...</h3>

      <!-- 🎙️ Transcript Area -->
      <div id="transcript">
        <strong>Transcript:</strong>
        <p id="transcriptText" style="margin-top:5px;">Press start to begin recording...</p>
      </div>

      <div id="feedback"></div>
      <div id="progressDisplay">
        Question <span id="qIndex">0</span> of <span id="qTotal">0</span>
      </div>

      <div class="controls">
        <button id="startTranscriptionBtn">🎤 Start Speaking</button>
        <button id="stopTranscriptionBtn" disabled>🛑 Stop</button>
        <button id="nextBtn">➡ Next Question</button>
      </div>
    </div>
  </div>
</div>

<!-- Existing interview logic -->
<script src="{{ url_for('static', filename='js/interview.js') }}"></script>

<!-- 🧠 Speech-to-Text Integration -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const startBtn = document.getElementById("startTranscriptionBtn");
  const stopBtn = document.getElementById("stopTranscriptionBtn");
  const transcriptText = document.getElementById("transcriptText");

  // Start transcription
  startBtn.addEventListener("click", async () => {
    startBtn.disabled = true;
    stopBtn.disabled = false;
    transcriptText.textContent = "Listening... 🎙️";

    try {
      const res = await fetch("/start_transcription", { method: "POST" });
      const data = await res.json();
      if (data.status === "started") {
        transcriptText.textContent = "Recording started. Speak now...";
      }
    } catch (err) {
      transcriptText.textContent = "Error starting transcription.";
      console.error(err);
    }
  });

  // Stop transcription
  stopBtn.addEventListener("click", async () => {
    stopBtn.disabled = true;
    startBtn.disabled = false;
    transcriptText.textContent = "Processing your audio...";

    try {
      const res = await fetch("/stop_transcription", { method: "POST" });
      const data = await res.json();
      if (data.status === "stopped") {
        transcriptText.textContent = data.transcript || "No transcript available.";
      } else {
        transcriptText.textContent = "Something went wrong stopping transcription.";
      }
    } catch (err) {
      transcriptText.textContent = "Error stopping transcription.";
      console.error(err);
    }
  });
});
</script>
{% endblock %}
